package ch15;

import java.io.File;
import java.sql.Connection;
import java.sql.PreparedStatement;

import javax.servlet.http.HttpServletRequest;

import com.oreilly.servlet.MultipartRequest;
import com.oreilly.servlet.multipart.DefaultFileRenamePolicy;

public class BoardMgr {
	private DBConnectionMgr pool;

	public static final String SAVEFOLDER = "C:/Jsp/myapp/src/main/webapp/ch15/fileupload/";	
	public static final String ENCODING = "UTF-8";
	public static final int MAXSIZE = 1024*1024*20;	//20MB
	
	public BoardMgr() {
		pool = DBConnectionMgr.getInstance();
	}
	
	// board Insert
	public void insertBoard(HttpServletRequest req) {
		Connection con = null;
		PreparedStatement pstmt = null;
		String sql = null;
		try {
			File dir = new File(SAVEFOLDER);
			if(!dir.exists()/*존재하지 않으면*/) {
				dir.mkdirs();	// mkdirs는 상위폴더가 없어도 생성
				// mkdir은 상위폴더가 없으면 생성 불가
			}
			MultipartRequest multi = 
					new MultipartRequest(req, SAVEFOLDER, MAXSIZE, ENCODING
							,new DefaultFileRenamePolicy());
			con = pool.getConnection();
			sql = "INSERT INTO tblboard "
				+ "VALUES(?,?,?,?,?,?,?,now(),?,?,?,?,?) ";
			pstmt = con.prepareStatement(sql);
			pstmt.setInt(1, req.getParameter("num"));
			pstmt.setString(2, req.getParameter("num"));
			pstmt.setString(3, req.getParameter("num"));
			pstmt.setString(4, req.getParameter("num"));
			pstmt.setInt(5, );
			pstmt.setInt(6, );
			pstmt.setInt(7, );
			pstmt.setString(8, 0);
			pstmt.setString(9, 0);
			pstmt.setInt(10, );
			pstmt.setString(11, 0);
			pstmt.setInt(12, );
			pstmt.executeUpdate();
		} catch (Exception e) {
			e.printStackTrace();
		} finally {
			pool.freeConnection(con, pstmt);
		}
	}
	// board Max Num : num의 현재 최대값
	// board Total Count : 총 게시물 수
	// board List : 검색기능, 페이징 및 블록
	// board Get : 게시물 한개 읽어오기(13개의 컬럼 리턴)
	// Count up : 조회수 증가
	// board delete : 파일업로드 파일까지 삭제
	// board Update : 파일업로드 수정
	// board Reply : 답변글 입력
	// board Reply Up : 답변글 위치값 수정
	// 게시물 1000개 입력
}
